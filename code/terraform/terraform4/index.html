<!doctype html><html itemscope itemtype=https://schema.org/WebPage class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://www.thedevopscat.co.uk/"><meta name=author content="thedevopscat"><meta name=description content="thedevopscat blog, thoughts, observations and learnings of the devopscat on Devops, Azure, Terraform, Static Websites, Hugo, Themes, Git, Github, Github Actions, Professional Certifications and Cute Cat Videos!"><meta name=keywords content="blog,personal,cats,devops,terraform,azure,hugo,algolia,git,github"><meta name=generator content="Hugo 0.134.3"><title>Terraform Conditional Expressions|thedevopscat blog</title>
<meta itemprop=name content="Terraform Conditional Expressions"><meta itemprop=description content="Terraform Conditional Expressions - thedevopscat blog, thoughts, observations and learnings of the devopscat on Devops, Azure, Terraform, Static Websites, Hugo, Themes, Git, Github, Github Actions, Professional Certifications and Cute Cat Videos!"><meta property="og:site_name" content="thedevopscat blog"><meta property="og:url" content="https://www.thedevopscat.co.uk/code/terraform/terraform4/"><meta property="og:site_name" content="thedevopscat blog"><meta property="og:title" content="Terraform Conditional Expressions"><meta property="og:description" content="As you are no doubt aware, Terraform is a declarative laungage, it reads like a shopping list rather than code with a bunch of conditional statements. I like to think of it as matter of fact, there simply isn’t if, elseif (etc) type statements at play here and this is a (generally) a good thing. “Do or do not…” as somebody wise once said… (I know my audience!)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="code"><meta property="article:published_time" content="2022-12-23T14:44:39+00:00"><meta property="article:modified_time" content="2022-12-23T14:44:39+00:00"><meta property="article:tag" content="Terraform"><script src=/modernizr-simple.js></script><link href=/code/terraform/terraform4/ rel=alternate type=application/rss+xml title="thedevopscat blog"><link href=/code/terraform/terraform4/ rel=feed type=application/rss+xml title="thedevopscat blog"><link rel=canonical href=https://www.thedevopscat.co.uk/code/terraform/terraform4/><link rel=stylesheet href=https://www.thedevopscat.co.uk/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=/categories/hugo/ target>Hugo+Themes</a></li><li><a href=/categories/terraform/ target>Terraform</a></li><li><a href=https://github.com/thedevopscat target='_blank" rel="nofollow noopener noreferrer'>My Github</a></li><li><a href=/page/disclaimer/>Disclaimer</a></li></ul><div id=search-box class=search><i class="fas fa-search"></i>
<input id=search type=text placeholder="Search ..."></div></div></nav><header><a id=back-to-top-button><i class="fas fa-angle-up"></i></a><div class=container><div class=logo><a href=/ class=logo><img src=/images/davey.jpg alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>thedevopscat blog</a></h3><span class=subtitle>Thoughts, observations and learnings of the devopscat...</span></div><div class=selectors></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://www.thedevopscat.co.uk/code/terraform/terraform4/><i class="fas fa-fw fa-jedi"></i></a><article class="default article"><div class=content><h1 class=article-title><a href=https://www.thedevopscat.co.uk/code/terraform/terraform4/>Terraform Conditional Expressions</a></h1><div class=meta><span class="date moment">2022-12-23</span>
<span class=readingTime>3 min read</span>
<span class=categories><a href=https://www.thedevopscat.co.uk/categories/terraform/>Terraform</a></span></div><p>As you are no doubt aware, Terraform is a declarative laungage, it reads like a shopping list rather than code with a bunch of conditional statements. I like to think of it as matter of fact, there simply isn&rsquo;t <em>if</em>, <em>elseif</em> (etc) type statements at play here and this is a (generally) a good thing. &ldquo;Do or do not&mldr;&rdquo; as somebody wise once said&mldr; (I know my audience!).</p><p>Anyway, it would be nice to turn things on and off for a given scenareo, this is expecially usefull when creating template code. For this we can use <a href=https://developer.hashicorp.com/terraform/language/expressions/conditionals target=_blank rel="noopener noreferrer">conditional expressions
</a>or conditionals to their friends.</p><p>A conditional breaks down like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#66d9ef>test</span> <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>some</span> <span style=color:#66d9ef>condition</span><span style=color:#960050;background-color:#1e0010>&gt;</span> <span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#66d9ef>true</span> <span style=color:#66d9ef>value</span><span style=color:#960050;background-color:#1e0010>&gt;</span> <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#960050;background-color:#1e0010>&lt;</span><span style=color:#66d9ef>false</span> <span style=color:#66d9ef>value</span><span style=color:#960050;background-color:#1e0010>&gt;</span>
</span></span></code></pre></div><p>We can store this in a variable, then use this conditionally set result to either do or not do something &mldr; (but we certainly won&rsquo;t simply try) &mldr; ok, I&rsquo;ll stop now!</p><p>Remember the <em>count index</em> from the <a href=/code/terraform/terraform2>first terraform post
</a>? Remember I mentioned in passing it could also be set to 0 and 1? Well, here is another &rsquo;logical&rsquo; use case.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;build_admin_vm&#34;</span> {
</span></span><span style=display:flex><span>  type        <span style=color:#f92672>=</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>  default     <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enables or disables the the build of the linux admin vm.&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_linux_virtual_machine&#34; &#34;aks1_preprod_linux_vm&#34;</span> {
</span></span><span style=display:flex><span>  count                           <span style=color:#f92672>=</span> <span style=color:#66d9ef>var</span>.<span style=color:#66d9ef>build_admin_vm</span> <span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#ae81ff>1</span> <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  name                            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;admin-vm&#34;</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Here we are using the <em>count</em> as a simple switch, the boolean condition of the variable is either true or false, resulting in a conditional value (count) of either 1 or 0. This code will either build 1 vm or 0 vm&rsquo;s respectively, hence this time the vm name also no longer needs a calculation for uniqueness, like in the <a href=/code/terraform/terraform2>first example
</a>use case.</p><p>I use this in test environments for big projects where I want to test a sub-section of the infrastructure with minimal cost and build times, I&rsquo;ll wrap this logic around things like VM&rsquo;s, Azure Application Gateway and Azure Firewall.</p><hr><p>Now for some bonus material I found when fact checking this post.</p><p>I particularly like this AWS based example, from the <a href="https://developer.hashicorp.com/terraform/tutorials/configuration-language/expressions?utm_source=WEBSITE&amp;utm_medium=WEB_IO&amp;utm_offer=ARTICLE_PAGE&amp;utm_content=DOCS#create-a-conditional-count-criteria" target=_blank rel="noopener noreferrer">terraform website</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;high_availability&#34;</span> {
</span></span><span style=display:flex><span>  type        <span style=color:#f92672>=</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>  description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;If this is a multiple instance deployment, choose `true` to deploy 3 instances&#34;</span>
</span></span><span style=display:flex><span>  default     <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34; &#34;ubuntu&#34;</span> {
</span></span><span style=display:flex><span>  count                       <span style=color:#f92672>=</span> (var.high_availability <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> <span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#ae81ff>3</span> <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>  ami                         <span style=color:#f92672>=</span> <span style=color:#66d9ef>data</span>.<span style=color:#66d9ef>aws_ami</span>.<span style=color:#66d9ef>ubuntu</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>  instance_type               <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>  associate_public_ip_address <span style=color:#f92672>=</span> (count.index <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#960050;background-color:#1e0010>?</span> <span style=color:#66d9ef>true</span> <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>  subnet_id                   <span style=color:#f92672>=</span> <span style=color:#66d9ef>aws_subnet</span>.<span style=color:#66d9ef>subnet_public</span>.<span style=color:#66d9ef>id</span>
</span></span><span style=display:flex><span>  tags                        <span style=color:#f92672>=</span> <span style=color:#66d9ef>merge</span>(<span style=color:#66d9ef>local</span>.<span style=color:#66d9ef>common_tags</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is notable for the following reasons:</p><ul><li>Offers a variance of my on/off functionaity to basic/high availability.</li><li>Associates a single public IP to just the first of potentially 3 vm&rsquo;s to use as a jump box.</li></ul><p>Nice! I&rsquo;ll show my version of this in a future post.</p></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://www.thedevopscat.co.uk/tags/terraform/>Terraform</a></div></div></div></article></div><div id=comments-container><script src=https://giscus.app/client.js data-repo=thedevopscat/blogcomments data-repo-id=R_kgDOIoOO8A data-category=General data-category-id=DIC_kwDOIoOO8M4CTG6Z data-mapping=www data-reactions-enabled=1 data-emit-metadata data-theme=light data-lang=en crossorigin=anonymous async></script><div id=giscus></div></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://www.thedevopscat.co.uk/code/terraform/terraform15/>Automatic Code Generation for Imported Resources!</a></li><li><a href=https://www.thedevopscat.co.uk/2023/02/adding-grafana-cloud-website-monitoring-via-terraform/>Adding Grafana Cloud Website Monitoring via Terraform</a></li><li><a href=https://www.thedevopscat.co.uk/2023/01/azure-static-web-apps-vs-github-pages/>Azure Static Web Apps vs Github Pages</a></li><li><a href=https://www.thedevopscat.co.uk/2023/01/static-website-hosting-on-github-part-3/>Static Website Hosting on Github - Part 3</a></li><li><a href=https://www.thedevopscat.co.uk/2023/01/static-website-hosting-on-github-part-2/>Static Website Hosting on Github - Part 2</a></li><li><a href=https://www.thedevopscat.co.uk/2023/01/static-website-hosting-on-github-part-1/>Static Website Hosting on Github - Part 1</a></li><li><a href=https://www.thedevopscat.co.uk/2023/01/what-info-is-permissible-on-a-redacted-cv/>What Info is Permissible on a Redacted CV?</a></li></ul></div><div class=categories><a href=/categories/><strong>Categories</strong></a><ul><li><a href=/categories/hugo>Hugo
(8)</a></li><li><a href=/categories/terraform>Terraform
(7)</a></li><li><a href=/categories/github-pages>Github pages
(5)</a></li><li><a href=/categories/psychology>Psychology
(2)</a></li><li><a href=/categories/cats>Cats
(1)</a></li><li><a href=/categories/privacy>Privacy
(1)</a></li></ul></div><div class=right><div class=external-profiles><strong>My Links</strong>
<a href=https://www.linkedin.com/in/mr-david-kent target=_blank rel=me><em class="fab fa-linkedin"></em></a>
<a href=https://github.com/thedevopscat target=_blank rel><em class="fab fa-github"></em></a>
<a href=https://discord.com/users/thedevopscat#8281 target=_blank rel><em class="fab fa-discord"></em></a><br><br><a href=https://www.buymeacoffee.com/thedevopscat target=_blank rel="nofollow noopener noreferrer" rel=me><img src=/images/bmc_qr.png width=84px height=80px alt="Buy Me A Coffee"></a></div><div class=archive><a href=/archive/><strong>Archive</strong></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://www.thedevopscat.co.uk/page/disclaimer/ target=_blank>&copy;
2024
thedevopscat</a></div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Powered by Bilberry Hugo Theme</a></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-F4HL48LHFR"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F4HL48LHFR")}</script><script src=https://www.thedevopscat.co.uk/theme.js></script><div id=activate-algolia-search class=hidden><input type=hidden id=algolia-search-appId value=CKM9HO0A7S>
<input type=hidden id=algolia-search-apiKey value=180d489edd420a08db5915d22d7232db>
<input type=hidden id=algolia-search-indexName value=gitdoc>
<input type=hidden id=algolia-search-noSearchResults value="Nothing found.">
<input type=hidden id=algolia-search-currentLanguageOnly></div></body></html>